<%- include('../layouts/header.ejs') %>
<%- include('../layouts/navbar.ejs') %>
<%- include('../layouts/sidebar.ejs') %>


<div class="main-panel">
  <div class="content-wrapper">
    <div class="row">
      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">SALES REPORT</h4>
            <div class="row justify-content-end">

            </div>                  
            <div class="table-responsive">
              <table id="example" class="table datatable">
                <thead>
                  <tr>
                    <th class="text-center">No.</th>
                    <th class="text-center">Date</th>
                    <th class="text-center">User Name</th>
                    <th class="text-center">Address</th>
                    <th class="text-center">Product Name</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-center">Payment Method</th>
                    <th class="text-center">Total</th>
                  </tr>
                </thead>
                <tbody>
                  <% sales.forEach((order, index) => { %>
                    <% order.product.forEach((product, i) => { %>
                      <tr>
                        <% if (i === 0) { %>
                          <th scope="row" rowspan="<%= order.product.length %>"><%= index + 1 %></th>
                          <td rowspan="<%= order.product.length %>"><%= order.date.toLocaleString() %></td>
                          <% if (order.user) { %>
                            <td rowspan="<%= order.product.length %>"><%= order.user.name %></td>
                            <td rowspan="<%= order.product.length %>"><%= order.user.address %></td>
                          <% } else { %>
                            <td rowspan="<%= order.product.length %>">N/A</td>
                            <td rowspan="<%= order.product.length %>">N/A</td>
                          <% } %>
                        <% } %>
                        <td><%= product.productId.name %></td>
                        <td><%= product.quantity %></td>
                        <% if (i === 0) { %>
                          <td rowspan="<%= order.product.length %>">
                            <span class="badge badge-success"><%= order.paymentType %></span>
                          </td>
                          <td rowspan="<%= order.product.length %>">â‚¹<%= order.total %></td>
                        <% } %>
                      </tr>
                    <% }) %>
                  <% }) %>
                </tbody>
              </table>
              
              
              
            </div>
          </div>
        </div>
      </div>



      <script>
$(document).ready(function() {
  // Initialize the DataTable
  $('#example').DataTable({
    dom: 'Bfrtip',
    buttons: [
      {
        extend: 'csv',
        text: '<i class="fa fa-file-csv"></i> Export CSV',
        className: 'btn btn-outline-primary',
        exportOptions: {
          columns: ':visible'
        }
      },
      {
        extend: 'pdf',
        text: '<i class="fa fa-file-pdf"></i> Export PDF',
        className: 'btn btn-outline-primary',
        exportOptions: {
          columns: ':visible'
        }
      },
      {
        extend: 'print',
        text: '<i class="fa fa-print"></i> Print',
        className: 'btn btn-outline-primary',
        exportOptions: {
          columns: ':visible'
        }
      }
    ]
  });
});

      </script> 



  <!-- plugins:js -->
  <!-- <script src="/assets/vendors/js/vendor.bundle.base.js"></script> -->
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="/user/vendors/chart.js/Chart.min.js"></script>
  <script src="/user/vendors/datatables.net/jquery.dataTables.js"></script>
  <script src="/user/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
  <script src="/user/js/dataTables.select.min.js"></script>

  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="/user/js/off-canvas.js"></script>
  <script src="/user/js/hoverable-collapse.js"></script>
  <script src="/user/js/template.js"></script>
  <script src="/user/js/settings.js"></script>
  <script src="/user/js/todolist.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="/user/js/dashboard.js"></script>
  <script src="/user/js/Chart.roundedBarCharts.js"></script>
  <!-- End custom js for this page-->

</body>

</html>